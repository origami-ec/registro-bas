<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                template="/template/bpmTemplate.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:co="http://xmlns.jcp.org/jsf/composite/co">
    <ui:define name="content">
        <h:form id="mainForm">
            <center><h1>ADMINISTRACION PARA CREACION DE FICHAS</h1></center>
            <p:tabView id="tbViewTramites">
                <p:tab title="Inscripciones">
                    <h:panelGrid columns="3">
                        <co:inputDate label="Fec.Insc.(Desde):" value="#{manageTramitesFicha.desde}" maxdate="sysdate"/>
                        <co:inputDate label="Fec.Insc.(Hasta):" value="#{manageTramitesFicha.hasta}" maxdate="sysdate"/>
                        <p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{manageTramitesFicha.buscarMovimientos()}"
                                         update="mainForm:tbViewTramites:dtMovsFicha"/>
                    </h:panelGrid>
                    <p:dataTable id="dtMovsFicha" value="#{manageTramitesFicha.movimientos}" var="movs" style="text-align: center;"
                                 rowIndexVar="index" rows="15" paginator="true"
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                        <f:facet name="header">INSCRIPCIONES SIN FICHA</f:facet>
                        <p:column headerText="No" width="20">
                            <h:outputText value="#{index+1}" />
                        </p:column>
                        <p:column headerText="Contrato">
                            #{movs.acto.nombre}
                        </p:column>
                        <p:column headerText="Inscripcion">
                            #{movs.numInscripcion}
                        </p:column>
                        <p:column headerText="Fecha Ins.">
                            <h:outputText value="#{movs.fechaInscripcion}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </p:tab>
                <p:tab title="Ordenes de Trabajo">
                    <div align="right">
                        <p:commandButton value="Nueva Orden de Inscripcion" icon="ui-icon-plus" actionListener="#{manageTramitesFicha.showDlgNewOrder()}"/>
                    </div>
                    <p:dataTable paginator="true" lazy="true" rows="15" style="text-align: center" rowsPerPageTemplate="15,30,50" 
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords}"
                                 value="#{manageTramitesFicha.ordenes}" var="ord" emptyMessage="No se encontrÃ³ ordenes" filterEvent="enter">
                        <p:column headerText="No Orden" filterBy="#{ord.numOrden}" sortBy="#{ord.numOrden}" filterStyle="width: 95%">
                            <h:outputText  value="#{ord.numOrden}"/>
                        </p:column>
                        <p:column headerText="Usuario" filterBy="#{ord.usuario.usuario}">
                            <h:outputText value="#{ord.usuario.usuario}"/>
                        </p:column>
                        <p:column headerText="Periodo">
                            <h:outputText value="#{ord.anioOrden} - #{ord.mesOrden}"/>
                        </p:column>
                        <p:column headerText="Fecha de Orden">
                            <h:outputText value="#{ord.fechaOrden}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Estado">
                            <h:outputText value="PENDIENTE" rendered="#{ord.estado eq 1}"/>
                            <h:outputText value="FINALIZADO" rendered="#{ord.estado eq 2}"/>
                        </p:column>
                        <p:column headerText="Tipo de Orden">
                            <h:outputText value="INSCRIPCION" rendered="#{ord.tipoOrden eq 1}"/>
                            <h:outputText value="TRAMITE" rendered="#{ord.tipoOrden eq 2}"/>
                        </p:column>
                        <p:column headerText="Acciones" width="50">
                            <p:commandLink title="Realizar" actionListener="#{manageTramitesFicha.realizarOrden(ord)}">
                                <p:graphicImage value="/resources/icons/edit.png" height="20"/>   
                            </p:commandLink>
                            <p:spacer width="5"/>
                            <p:commandLink title="Visualizar">
                                <p:graphicImage value="/resources/icons/abrir.png" height="20"/>   
                            </p:commandLink>
                            <!--<p:commandLink title="Marcar Realizada">
                                <p:graphicImage value="/resources/icons/check.png" height="20"/>   
                            </p:commandLink>-->
                        </p:column>
                    </p:dataTable>
                </p:tab>
                <p:tab title="Fichas Mal Generadas" rendered="false">

                </p:tab>
            </p:tabView>
        </h:form>

        <p:dialog widgetVar="dlgOrder" header="NUEVA ORDEN DE TRABAJO" modal="true">
            <h:form id="frmOrder">
                <h:panelGrid columns="1" style="font-weight: bolder;text-align: center;">
                    <co:inputDate label="Fecha Periodo:" value="#{manageTramitesFicha.periodo}"/>
                    <co:inputSelect label="Usuario:" value="#{manageTramitesFicha.user}" catalogo="#{manageTramitesFicha.usuarios}" 
                                    var="us" itemLabel="#{us.ente.nombres} - #{us.usuario}" itemValue="#{us}"/>
                    <p:commandButton value="Guardar Orden" actionListener="#{manageTramitesFicha.saveOrder()}"/>
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog header="REALIZAR ORDEN DE TRABAJO" widgetVar="dlgRealizarOrden" modal="true" position="top" width="100%">
            <h:form id="formRealizarOrden">
                <h:panelGrid columns="6" style="font-weight: bolder;font-size: 16px;">
                    No Orden:
                    <p:inputText value="#{manageTramitesFicha.orden.numOrden}" readonly="true"/>
                    Usuario:
                    <p:inputText value="#{manageTramitesFicha.orden.usuario.usuario}" readonly="true"/>
                    Periodo:
                    <p:inputText value="#{manageTramitesFicha.orden.periodo}" readonly="true"/>
                </h:panelGrid>
                <h:panelGroup style="width: 50%;float: left;">
                    <p:dataTable id="dtMovs2" value="#{manageTramitesFicha.movs2}" var="mov2" style="text-align: center;"
                                 rowIndexVar="index2" rows="15" paginator="true" resizableColumns="true" 
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                        <f:facet name="header">INSCRIPCIONES SIN FICHA</f:facet>
                        <p:column headerText="No" width="20">
                            <h:outputText value="#{index2+1}" />
                        </p:column>
                        <p:column headerText="Contrato">
                            #{mov2.acto.nombre}
                        </p:column>
                        <p:column headerText="Inscripcion">
                            #{mov2.numInscripcion}
                        </p:column>
                        <p:column headerText="Fecha Ins.">
                            <h:outputText value="#{mov2.fechaInscripcion}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="**" width="16">
                            <p:commandLink title="Ingresar" actionListener="#{manageTramitesFicha.registrarOrden(mov2)}">
                                <p:graphicImage value="/resources/icons/ir.png" height="16"/>   
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                </h:panelGroup>
                <h:panelGroup style="width: 50%;float: right;">
                    <p:dataTable id="dtDetalles2" value="#{manageTramitesFicha.detalles}" var="det" style="text-align: center;"
                                 rowIndexVar="index" rows="15" paginator="true" resizableColumns="true" 
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                        <f:facet name="header">DETALLE DE ORDENES</f:facet>
                        <p:column headerText="No" width="20">
                            <h:outputText value="#{index+1}" />
                        </p:column>
                        <p:column headerText="Fecha Ingreso">
                            <h:outputText value="#{det.fechaInicio}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="No Incripcion">
                            <h:outputText value="#{det.movimiento.numInscripcion}/"/>
                            <h:outputText value="#{det.movimiento.fechaInscripcion}"><f:convertDateTime pattern="yyyy"/></h:outputText>
                        </p:column>
                        <!--<p:column headerText="No Ficha">
                            <h:outputText value="# {det.ficha.numFicha}"/>
                        </p:column>-->
                        <p:column headerText="Fecha fin">
                            <h:outputText value="#{det.fechaFin}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="**" width="16">
                            <p:commandLink title="Finalizar" actionListener="#{manageTramitesFicha.marcarFinalizada(det)}"
                                           disabled="#{det.fechaFin ne null}">
                                <p:graphicImage value="/resources/icons/check.png" height="16"/>   
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                </h:panelGroup>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>