<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                template="/template/bpmTemplate.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">
        <h:form id="mainForm">
              <center><h2>Observaciones</h2></center>
            <p:panelGrid styleClass="noBorder" style="width: 100%">
                <p:commandButton value="Nueva Observacion" icon="ui-icon-plus" style="float: right" styleClass="btnStyle" actionListener="#{ingresoObservaciones.showDlgObs()}"/>
            </p:panelGrid>
            <p:accordionPanel id="accObvs" activeIndex="1">
                <p:tab title="REPORTE DIARIO DE OBSERVACIONES" titleStyle="font-weight: bold;background: #616161; color: #FFFFFF;">
                    <p:panelGrid styleClass="noBorder" style="text-align: center;font-weight: bolder;" columns="4">
                        Tipo Reporte:
                        <p:selectOneMenu value="#{ingresoObservaciones.reporte}">
                            <f:selectItem itemLabel="Todos los Ingresos" itemValue="#{1}" />
                            <f:selectItem itemLabel="Solo ACEPTADOS" itemValue="#{2}" />
                        </p:selectOneMenu>
                        Usuario:
                        <p:selectOneMenu value="#{ingresoObservaciones.user}" converter="entityConverter">
                            <f:selectItem itemLabel="TODOS" itemValue="#{null}" />
                            <f:selectItems value="#{ingresoObservaciones.revisores}" var="rev" itemLabel="#{rev.usuario}" itemValue="#{rev}"/>
                        </p:selectOneMenu>
                    </p:panelGrid >
                    <p:panelGrid styleClass="noBorder" style="text-align: center;font-weight: bolder;" columns="5">
                        Desde:
                        <p:calendar value="#{ingresoObservaciones.desde}" pattern="dd/MM/yyyy" placeholder="dd/MM/yyyy"/>
                        Hasta:
                        <p:calendar value="#{ingresoObservaciones.hasta}" pattern="dd/MM/yyyy" placeholder="dd/MM/yyyy"/>
                        <p:commandButton value="Reporte" icon="ui-icon-document" styleClass="btnStyle" actionListener="#{ingresoObservaciones.generarReporteFecha()}"/>
                    </p:panelGrid>
                </p:tab>
                <p:tab title="OBSERVACIONES INGRESADAS" titleStyle="font-weight: bold;background: #616161; color: #FFFFFF;">
                    <p:dataTable id="dtentes" reflow="true" paginator="true" lazy="true" rows="20" rowsPerPageTemplate="20,50,100" filterEvent="enter"
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 value="#{ingresoObservaciones.lazyObvs}" var="ob" emptyMessage="No se encontró ningún Item" style="text-align: center;">
                        <p:column headerText="Numero" filterBy="#{ob.numero}" sortBy="#{ob.numero}" width="120">
                            <p:outputLabel value="#{ob.numero}"/>
                        </p:column>
                        <p:column headerText="N° Tramite" filterBy="#{ob.liquidacion.numTramiteRp}" sortBy="#{ob.liquidacion.numTramiteRp}" width="120">
                            <p:outputLabel value="#{ob.liquidacion.numTramiteRp}"/>
                        </p:column>
                        <p:column headerText="C.I./R.U.C." width="150" filterBy="#{ob.documento}" filterStyle="width: 95%;">
                            <h:outputText value="#{ob.ente.ciRuc}"/>
                        </p:column>
                        <p:column headerText="Nombres" filterStyle="width: 95%;">
                            <h:outputText value="#{ob.ente.nombreCompleto}"/>
                        </p:column>
                        <p:column headerText="Fecha" sortBy="#{ob.fechaIngreso}" width="120">
                            <p:outputLabel value="#{ob.fechaIngreso}"><f:convertDateTime pattern="dd-MM-yyyy"/></p:outputLabel>
                        </p:column>
                        <p:column headerText="Revisor" width="100">
                            <h:outputText value="#{ob.userIngreso.usuario}"/>
                        </p:column>
                        <p:column headerText="Estado" width="100">
                            <h:outputText value="ACEPTADO" rendered="#{ob.estado eq 'A'}"/>
                            <h:outputText value="CORRECION" rendered="#{ob.estado eq 'C'}"/>
                        </p:column>
                        <p:column headerText="Opcs." width="60">
                            <p:commandLink actionListener="#{ingresoObservaciones.generarReporte(ob)}" title="Documento">
                                <p:graphicImage value="/resources/icons/reporte.png" height="16"/>
                            </p:commandLink>
                            <p:spacer width="5" />
                            <p:commandLink actionListener="#{ingresoObservaciones.editarObservacion(ob)}" disabled="#{ob.estado eq 'A'}" title="Editar">
                                <p:graphicImage value="/resources/icons/editar.png" height="16"/>
                            </p:commandLink>
                        <p:spacer width="5" />
                        <p:commandLink actionListener="#{ingresoObservaciones.ingresarProforma(ob)}" disabled="#{ob.estado eq 'A'}" title="Proforma" >
                                <p:graphicImage value="/resources/icons/ir.png" height="16"/>
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                </p:tab>
            </p:accordionPanel>
        </h:form>

        <p:dialog header="Observaciones" widgetVar="dlgObvs" modal="true" resizable="false" closeOnEscape="true"
                  position="center" width="1000" height="60%">
            <h:form id="frmObvs">
                <p:fieldset legend="Informacion">
                    <p:panelGrid id="pnlCliente" columns="7" styleClass="noBorder" style="font-weight: bolder;">
                        Motivo Ingreso:
                        <p:selectOneMenu value="#{ingresoObservaciones.motivo}">
                            <f:selectItem itemLabel="Revision de Documentos" itemValue="#{1}" />
                            <f:selectItem itemLabel="Consultas y Otros" itemValue="#{2}" />
                        </p:selectOneMenu>
                        CI/RUC:
                        <p:inputText value="#{ingresoObservaciones.observacion.ente.ciRuc}" readonly="true"/>
                        Nombres:
                        <p:inputText value="#{ingresoObservaciones.observacion.ente.nombreCompleto}" readonly="true" size="30"/>
                        <p:commandButton value="Buscar" icon="ui-icon-search" styleClass="btnStyle" actionListener="#{ingresoObservaciones.showDlg('/resources/dialog/dlglazyente')}">
                            <p:ajax event="dialogReturn" listener="#{ingresoObservaciones.selectObject}" update="pnlCliente"/>
                        </p:commandButton>
                    </p:panelGrid>
                </p:fieldset>
                <p:fieldset legend="Observacion 1">
                    <p:inputTextarea style="width: 99%" value="#{ingresoObservaciones.observacion.observacion1}" autoResize="false"/>
                </p:fieldset>
                <p:fieldset legend="Observacion 2">
                    <p:inputTextarea style="width: 99%" value="#{ingresoObservaciones.observacion.observacion2}" autoResize="false"/>
                </p:fieldset>
                <p:fieldset legend="Observacion 3">
                    <p:inputTextarea style="width: 99%" value="#{ingresoObservaciones.observacion.observacion3}" autoResize="false"/>
                </p:fieldset>
                <br/>
                <div align="center">
                    <p:commandButton value="Guardar" icon="ui-icon-check" styleClass="btnStyle" actionListener="#{ingresoObservaciones.saveObservacion()}"/>
                </div>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>