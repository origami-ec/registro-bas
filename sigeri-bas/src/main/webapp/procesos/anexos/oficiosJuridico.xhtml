<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/bpmTemplate.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="title">Solicitudes Júridico</ui:define>
    <ui:define name="content">
        <h:form id="mainForm">

            <div class="card card-w-title">
                <center><h2>Solicitudes Júridico </h2></center>
                <p:commandButton value="Nueva Solicitud" icon="ui-icon-plus" style="float: right" styleClass="btnStyle" 
                                 actionListener="#{tareasDinardapJuridico.showDlgIngreso()}"/>
                <br></br>
                <br></br>
                <br></br>
                <p:dataTable id="dtTareasDinardap" reflow="true" paginator="true" lazy="true" rows="20" rowsPerPageTemplate="20,50,100" resizableColumns="true"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             value="#{tareasDinardapJuridico.tareasLazy}" var="tar" emptyMessage="Sin elementos..." filterEvent="enter" style="text-align: center;"
                             rowStyleClass="#{!tar.realizado ? 'orange' : null}">
                    <p:column headerText="Ticket" filterBy="#{tar.ticket}" filterStyle="width: 95%">
                        <p:outputLabel value="#{tar.ticket}"/>
                    </p:column>
                    <p:column headerText="Juicio" filterBy="#{tar.numeroSolicitud}" filterStyle="width: 95%">
                        <p:outputLabel value="#{tar.numeroSolicitud}"/>
                    </p:column>
                    <p:column headerText="Institucion Solicitante" filterBy="#{tar.institucion}" filterStyle="width: 95%">
                        <p:outputLabel value="#{tar.institucion}"/>
                    </p:column>
                    <p:column headerText="Deudor / Prohibición Solicitante" filterBy="#{tar.solicitante}" filterStyle="width: 95%">
                        <p:outputLabel value="#{tar.solicitante}"/>
                    </p:column>
                    <p:column headerText="Usuario Ingreso" >
                        <p:outputLabel value="#{tar.usuario}"/>
                    </p:column>
                    <p:column headerText="Acto" >
                        <p:outputLabel value="#{tar.acto.nombre}"/>
                    </p:column>
                    <p:column headerText="Fecha Ing." width="100"  >
                        <p:outputLabel value="#{tar.fecha}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </p:outputLabel>
                    </p:column>
                    <p:column headerText="Fecha Despacho" width="100"  >
                        <p:outputLabel value="#{tar.fechaDespacho}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </p:outputLabel>
                    </p:column>
                    <p:column headerText="Estado" width="100" >
                        <p:outputLabel value="#{tar.estadoTramite}"/>
                    </p:column>

                    <p:column headerText="Trámite" width="60">
                        <p:outputLabel value="#{tar.liquidacion.numTramiteRp}"/>
                    </p:column>
                    <p:column headerText="Detalle" width="60">
                        <p:commandLink actionListener="#{tareasDinardapJuridico.showDetalleTarea(tar)}">
                            <p:graphicImage value="/resources/icons/detalle.png" height="16"/>   
                        </p:commandLink>
                    </p:column>
                    <!--                    <p:column headerText="Docs." width="50">
                                            <p:commandLink actionListener="#{tareasDinardapJuridico.showDocsTarea(tar)}">
                                                <p:graphicImage value="/resources/icons/reporte.png" height="16"/>   
                                            </p:commandLink>
                                        </p:column>-->


                </p:dataTable>
            </div>
        </h:form>

        <p:dialog widgetVar="dlgDetalle" header="Informacion de Solicitud" modal="true" resizable="false" position="center">
            <h:form id="formDetalleTarea">
                <p:panelGrid styleClass="noBorder" columns="2" style="font-size: 12px;font-weight: bolder;">
                    Ticket:
                    <p:inputText value="#{tareasDinardapJuridico.tareaDinardap.ticket}" size="70"/>
                    # Juicio:
                    <p:inputText value="#{tareasDinardapJuridico.tareaDinardap.numeroSolicitud}" size="70"/>
                    Fec.Juicio
                    <p:calendar value="#{tareasDinardapJuridico.tareaDinardap.fecha}" pattern="dd/MM/yyyy" 
                                maxdate="sysdate"  
                                style="display: block; margin-top: 3px; min-width: 0px !important; width: 38% !important"/>
                    Fec. Despacho:
                    <p:calendar value="#{tareasDinardapJuridico.tareaDinardap.fechaDespacho}" pattern="dd/MM/yyyy" 
                                maxdate="sysdate"  
                                style="display: block; margin-top: 3px; min-width: 0px !important; width: 38% !important"/>
                    Institucion Solicitante:
                    <p:inputText value="#{tareasDinardapJuridico.tareaDinardap.institucion}" size="70"/>
                    Deudor / Prohibicion Solicitante:
                    <p:inputText value="#{tareasDinardapJuridico.tareaDinardap.solicitante}" size="70"/>
                    Estado
                    <p:selectOneMenu value="#{tareasDinardapJuridico.tareaDinardap.estadoTramite}">
                        <f:selectItem itemLabel="PENDIENTE" itemValue="PENDIENTE" />
                        <f:selectItem itemLabel="INSCRITO" itemValue="INSCRITO" />
                        <f:selectItem itemLabel="DEVUELTO" itemValue="DEVUELTO" />
                    </p:selectOneMenu>
                    Acto:
                    <p:selectOneMenu value="#{tareasDinardapJuridico.tareaDinardap.acto}" 
                                     converter="entityConverter" 
                                     filter="true" filterMatchMode="contains"
                                     style="display: block; margin-top: 3px; min-width: 0px !important; width: 60% !important" >
                        <f:selectItem itemLabel="Seleccionar" itemValue="#{null}" />
                        <f:selectItems value="#{tareasDinardapJuridico.actos}" var="p" itemLabel="#{p.nombre}" itemValue="#{p}"/>
                    </p:selectOneMenu>
                    Observacion:
                    <p:inputTextarea value="#{tareasDinardapJuridico.tareaDinardap.observacion}" cols="70" rows="8" 
                                     autoResize="false"/>
                </p:panelGrid>
                <p:panelGrid styleClass="noBorder" style="margin: 0 auto;" columns="1">
                    <p:commandButton value="Guardar" actionListener="#{tareasDinardapJuridico.guardarSolicitud()}"/>
                </p:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgIngresoTarea" header="Ingreso de Solicitud/Oficio"
                  modal="true" resizable="false" width="600" height="500">
            <h:form id="formInfoTarea">
                <p:panelGrid styleClass="noBorder" columns="2" style="font-size: 12px;font-weight: bolder;">
                    Ticket:
                    <p:inputText value="#{tareasDinardapJuridico.tareaDinardap.ticket}" size="70"/>
                    # Juicio:
                    <p:inputText value="#{tareasDinardapJuridico.tareaDinardap.numeroSolicitud}" size="70"/>
                    Fec.Juicio
                    <p:calendar value="#{tareasDinardapJuridico.tareaDinardap.fecha}" pattern="dd/MM/yyyy" 
                                maxdate="sysdate"  
                                style="display: block; margin-top: 3px; min-width: 0px !important; width: 38% !important"/>
                    Fec. Despacho:
                    <p:calendar value="#{tareasDinardapJuridico.tareaDinardap.fechaDespacho}" pattern="dd/MM/yyyy" 
                                maxdate="sysdate"  
                                style="display: block; margin-top: 3px; min-width: 0px !important; width: 38% !important"/>
                    Institucion Solicitante:
                    <p:inputText value="#{tareasDinardapJuridico.tareaDinardap.institucion}" size="70"/>
                    Deudor / Prohibicion Solicitante:
                    <p:inputText value="#{tareasDinardapJuridico.tareaDinardap.solicitante}" size="70"/>
                    Estado
                    <p:selectOneMenu value="#{tareasDinardapJuridico.tareaDinardap.estadoTramite}">
                        <f:selectItem itemLabel="PENDIENTE" itemValue="PENDIENTE" />
                        <f:selectItem itemLabel="INSCRITO" itemValue="INSCRITO" />
                        <f:selectItem itemLabel="DEVUELTO" itemValue="DEVUELTO" />
                    </p:selectOneMenu>
                    Acto:
                    <p:selectOneMenu value="#{tareasDinardapJuridico.tareaDinardap.acto}" 
                                     converter="entityConverter" 
                                     filter="true" filterMatchMode="contains"
                                     style="display: block; margin-top: 3px; min-width: 0px !important; width: 60% !important" >
                        <f:selectItem itemLabel="Seleccionar" itemValue="#{null}" />
                        <f:selectItems value="#{tareasDinardapJuridico.actos}" var="p" itemLabel="#{p.nombre}" itemValue="#{p}"/>
                    </p:selectOneMenu>
                    Observacion:
                    <p:inputTextarea value="#{tareasDinardapJuridico.tareaDinardap.observacion}" cols="70" rows="8" 
                                     autoResize="false"/>
                </p:panelGrid>
                <p:panelGrid styleClass="noBorder" style="margin: 0 auto;" columns="1">
                    <p:commandButton value="Guardar" actionListener="#{tareasDinardapJuridico.guardarSolicitud()}"/>
                </p:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgTareas" header="Tareas de Solicitud" modal="true" resizable="false" position="center"  width="600">
            <h:form id="formTareas">
                <p:tabView>
                    <p:tab title="Tareas Ingresadas">
                        <p:panelGrid styleClass="noBorder" style="margin: 0 auto;text-align: center;" columns="3">
                            Seleccionar:
                            <p:selectOneMenu  value="#{tareasDinardapJuridico.tipo}" converter="entityConverter">  
                                <f:selectItem itemLabel="Seleccionar" itemValue="#{null}" />  
                                <f:selectItems value="#{tareasDinardapJuridico.tiposCertificado}" var="tip" itemLabel="#{tip.nombre}" itemValue="#{tip}"/>  
                            </p:selectOneMenu>
                            <p:commandButton value="Agregar" icon="ui-icon-plus" styleClass="btnStyle" actionListener="#{tareasDinardapJuridico.crearTarea()}"/>
                        </p:panelGrid>
                        <p:dataTable value="#{tareasDinardapJuridico.tareas}" var="ins" scrollable="true" scrollHeight="200" rowIndexVar="indInsc">
                            <p:column headerText="Detalle">
                                #{ins.observacion}
                            </p:column>
                            <p:column headerText="Doc." width="60">
                                <p:commandLink actionListener="#{tareasDinardapJuridico.visualizarDoc(ins)}" disabled="#{!ins.realizado}">
                                    <p:graphicImage value="/resources/icons/reporte.png" height="16"/>   
                                </p:commandLink>
                            </p:column>
                            <p:column headerText="Tarea" width="60">
                                <p:graphicImage value="/resources/icons/ok.png" height="16" rendered="#{ins.realizado}"/>
                                <p:graphicImage value="/resources/icons/delete.png" height="16" rendered="#{!ins.realizado}"/>
                            </p:column>
                            <p:column headerText="Accion" width="60">
                                <p:commandLink actionListener="#{tareasDinardapJuridico.redirecTarea(ins)}" disabled="#{ins.realizado}">
                                    <p:graphicImage value="/resources/icons/ir.png" height="16"/>   
                                </p:commandLink>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Finalizar" disabled="#{tareasDinardapJuridico.tareaDinardap.realizado}">
                        <p:fieldset legend="Finalizar Solicitud">
                            <p:panelGrid styleClass="noBorder" style="margin: 0 auto;text-align: center;" columns="1">
                                <p:commandButton value="Finalizar Solicitud" icon="ui-icon-close" styleClass="btnStyle" actionListener="#{tareasDinardapJuridico.finalizarSolicitud()}"/>
                            </p:panelGrid>
                        </p:fieldset>
                    </p:tab>
                </p:tabView>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgDocumentos" header="Documentos de la Solicitud" modal="true" resizable="false" 
                  position="center" width="600">
            <h:form id="formDocumentos">
                <center>
                    <p:outputLabel value="No Solicitud: #{tareasDinardapJuridico.tareaDinardap.numeroSolicitud}" style="font-weight: bolder;font-size: 14px;"/>
                    <p:dataTable value="#{tareasDinardapJuridico.tareaDinardap.regpTareasDinardapDocsCollection}" var="docs" scrollable="true" scrollHeight="200"
                                 style="text-align: center;" emptyMessage="Esta Tarea no tiene Documentos Adjuntos.">
                        <p:column headerText="Nombre Documento">
                            #{docs.nombreArchivo}
                        </p:column>
                        <p:column headerText="Desc." width="50">
                            <p:commandLink actionListener="#{tareasDinardapJuridico.downloadDocTareas(docs)}">
                                <p:graphicImage value="/resources/icons/down.png" height="16"/>   
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgObervaciones" widgetVar="dlgObsvs" header="Cargar Documento" modal="true" width="500" height="300" 
                  resizable="false" position="center">
            <h:form id="formObs">
                <p:panelGrid styleClass="noBorder" style="margin: 0 auto;width: 100%;" columns="1">
                    <p:outputLabel value="ESPERE A QUE LA VENTANA SE CIERRE!!!" style="font-weight: bolder;color: #0033FF;font-size: 14px;"/>
                    <p:outputLabel value="No Solicitud: #{tareasDinardapJuridico.tareaDinardap.numeroSolicitud}" style="font-weight: bolder;font-size: 14px;"/>
                    <p:fileUpload listener="#{tareasDinardapJuridico.handleUpload}" 
                                  mode="advanced" 
                                  fileLimit="1" 
                                  dragDropSupport="false" 
                                  sizeLimit="10000000000" 
                                  label="Seleccionar" 
                                  uploadLabel="Subir" 
                                  style="width: auto;" 
                                  cancelLabel="Cancelar" 
                                  allowTypes="/(\.|\/)(pdf|xlsx|docx|doc|xls)$/" />
                </p:panelGrid>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>