<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/bpmTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:co="http://xmlns.jcp.org/jsf/composite/co">
    <ui:define name="title">Asignación de Tareas</ui:define>
    <ui:define name="content">
        <h:form id="frmMain">
            <center><h3 style="font-weight: bolder;">ASIGNACIÓN DE TAREAS</h3></center>
            <h:panelGrid columns="4" style="width: 100%;">
                <co:inputSelect catalogo="#{tareasUsuarios.roles}" var="rol1" itemLabel="#{rol1.nombre}" itemValue="#{rol1}" 
                                label="Roles de Usuario:" value="#{tareasUsuarios.rolFilter}" useConverter="true">
                    <p:ajax event="ajax" listener="#{tareasUsuarios.buscarUser()}" update="frmMain:dtgTerasUsuarios" process="frmMain" />
                </co:inputSelect>
                <p:spacer width="100" height="1"/>
                <p:spacer width="100" height="1"/>
                <p:commandButton icon="pi pi-user" value="Agregar Usuario" actionListener="#{tareasUsuarios.setEdicion(true)}"
                                 action="#{tareasUsuarios.dlgSeleccionado(null)}" style="float: right;"/>
            </h:panelGrid>
            <h:panelGrid columns="1" style="margin: 0 auto;color: red;font-weight: bolder;">
                NOTA: No ingresar o activar usuarios antes de la primera asignación automática hecha por el Sistema.
            </h:panelGrid>
            <h:panelGrid columns="1" style="margin: 0 auto;color: red;font-weight: bolder;">
                Caso contrario todos los tramites se le asignan a solo ese usuario.
            </h:panelGrid>
            <p:dataTable id="dtgTerasUsuarios" reflow="true" paginator="true" lazy="true" rows="10" rowsPerPageTemplate="10,50,100" filterEvent="enter"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         value="#{tareasUsuarios.usuariosTareas}" var="ts1" emptyMessage="No se encontró ningún Item." style="width: 80%;margin: 0 auto;">
                <p:column headerText="***" width="40">
                    <p:graphicImage name="icons/administrator.png" height="40"/>
                </p:column>
                <p:column headerText="Usuario" width="120" filterBy="#{ts1.usuario.usuario}" >
                    <h:outputText value="#{ts1.usuario.usuario}"/>
                </p:column>
                <p:column headerText="Apellidos" filterBy="#{ts1.usuario.ente.apellidos}" >
                    <h:outputText value="#{ts1.usuario.ente.apellidos}"/>
                </p:column>
                <p:column headerText="Nombres" filterBy="#{ts1.usuario.ente.nombres}" >
                    <h:outputText value="#{ts1.usuario.ente.nombres}"/>
                </p:column>
                <p:column headerText="Rol" width="100">
                    <h:outputText value="#{ts1.rol.nombre}"/>
                </p:column>
                <p:column headerText="Asignacion" width="100">
                    <p:outputLabel value="COMPLETA" rendered="#{ts1.cantidadAux eq 1}"/>
                    <p:outputLabel value="MEDIA 50%" rendered="#{ts1.cantidadAux eq 2}"/>
                </p:column>
                <p:column headerText="Estado" width="60">
                    <p:outputLabel value="ACTIVO" rendered="#{ts1.estado}"/>
                    <p:outputLabel value="INACTIVO" rendered="#{!ts1.estado}"/>
                </p:column>
                <p:column headerText="Editar" width="60">
                    <p:commandButton icon="pi pi-pencil" actionListener="#{tareasUsuarios.setEdicion(true)}" 
                                     action="#{tareasUsuarios.dlgSeleccionado(ts1)}" process="frmDetUser" title="Editar" />
                </p:column>
            </p:dataTable>
            <!--<p:dataGrid value="# {tareasUsuarios.usuariosTareas}" var="ts1" layout="grid" columns="4" lazy="true" 
                        paginator="true" rows="8" class="Wid100" id="dtgTerasUsuarios" paginatorPosition="top" >
                <p:panel header="# {ts1.usuario.ente.nombres}" class="Wid100">
                    <div align="center" style="padding-top: 10px; ">
                        <p:graphicImage name="icons/administrator.png" height="80"/>
                    </div>
                    <h:panelGrid columns="2" style="width:100%;">
                        <p:outputLabel value="Usuario:" style="font-weight: bolder;" />
                        <p:outputLabel value="# {ts1.usuario.usuario}" style="text-transform: uppercase;"/>
                        <p:outputLabel value="Nombres:" style="font-weight: bolder;" />
                        <p:outputLabel value="# {ts1.usuario.ente.nombres}" />
                        <p:outputLabel value="Apellidos:" style="font-weight: bolder;"/>
                        <p:outputLabel value="# {ts1.usuario.ente.apellidos}" />
                        <p:outputLabel value="Rol:" style="font-weight: bolder;" />
                        <p:outputLabel value="# {ts1.rol.nombre}" style="text-transform: uppercase;"/>
                        <p:outputLabel value="Estado:" style="font-weight: bolder;" />
                        <p:outputLabel value="# {ts1.estado? 'ACTIVO' : 'INACTIVO'}"  />
                        <p:outputLabel value="Asignacion" style="font-weight: bolder;" />
                        <p:outputLabel value="# {ts1.cantidadAux eq 1 ? 'COMPLETA 100%' : 'MEDIA 50%'}"  />
                    </h:panelGrid>
                    <div align="center" style="padding-top: 10px; ">
                        <p:commandButton icon="pi pi-pencil" actionListener="# {tareasUsuarios.setEdicion(true)}" value="Editar"
                                         action="# {tareasUsuarios.dlgSeleccionado(ts1)}" process="frmDetUser" title="Editar" />
                    </div>
                </p:panel>
            </p:dataGrid>-->
        </h:form>

        <p:dialog id="usuarioTar" header="Detalle de Usuario" widgetVar="usuarioTar" modal="true" resizable="false">
            <h:form id="frmDetUser" >
                <h:panelGrid columns="1" style="font-weight: bolder;">
                    Usuario:
                </h:panelGrid>
                <h:panelGrid columns="2">
                    <p:inputText value="#{tareasUsuarios.seleccionado.usuario.usuario}" readonly="true"/>
                    <p:commandButton icon="pi pi-search" 
                                     actionListener="#{tareasUsuarios.buscarUsuario('/resources/dialog/dlglazyusers')}">
                        <p:ajax event="dialogReturn" listener="#{tareasUsuarios.procesar}" update="frmDetUser"/>
                    </p:commandButton>
                </h:panelGrid>
                <h:panelGrid columns="1" style="font-weight: bolder;">
                    Nombre Funcionario:
                    <p:inputText value="#{tareasUsuarios.seleccionado.usuario.ente.nombreCompleto}" readonly="true" style="width: 300px;"/>
                    Rol de Tarea:
                    <p:selectOneMenu value="#{tareasUsuarios.seleccionado.rol}" filter="true" 
                                     style="width: 300px;" converter="entityConverter">
                        <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" />
                        <f:selectItems value="#{tareasUsuarios.roles}" var="rol" itemLabel="#{rol.nombre}" itemValue="#{rol}"/>
                    </p:selectOneMenu> 
                    Estado:
                    <p:selectOneMenu value="#{tareasUsuarios.seleccionado.estado}" style="width: 300px;" >
                        <f:selectItem itemLabel="ACTIVO" itemValue="#{true}" />
                        <f:selectItem itemLabel="INACTIVO" itemValue="#{false}" />
                    </p:selectOneMenu>
                    Asignacion:
                    <p:selectOneMenu value="#{tareasUsuarios.seleccionado.cantidadAux}" style="width: 300px;" >
                        <f:selectItem itemLabel="COMPLETA" itemValue="#{1}" />
                        <f:selectItem itemLabel="MEDIA-50%" itemValue="#{2}" />
                    </p:selectOneMenu>
                </h:panelGrid>
                <div align="center" style="padding-top: 10px; ">
                    <p:commandButton value="Guardar" actionListener="#{tareasUsuarios.guardar()}" oncomplete="PF('usuarioTar').hide()" renderDisabledClick="true"
                                     rendered="#{tareasUsuarios.edicion}" update="frmMain, frmMain:dtgTerasUsuarios" icon="pi pi-save"/>
                    <p:spacer width="10" />
                    <p:commandButton value="Cerrar" actionListener="#{tareasUsuarios.reloadUsuario()}" icon="pi pi-times"
                                     oncomplete="PF('usuarioTar').hide()" renderDisabledClick="true" />
                </div>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
