<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="informeFichaIngresadas" language="groovy" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="44c41430-ab03-4fa9-995f-d6837b1f4bd8">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="580"/>
	<property name="ireport.y" value="0"/>
	<style name="ANULADA" mode="Opaque" forecolor="#000000" backcolor="#FF9999"/>
	<parameter name="DESDE" class="java.lang.String"/>
	<parameter name="HASTA" class="java.lang.String"/>
	<parameter name="HASTA_STRING" class="java.lang.String"/>
	<parameter name="USUARIO" class="java.lang.Long"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["C:\\Users\\Anyelo\\Desktop\\NetBeansProjects\\rpp\\src\\main\\webapp\\reportes\\diarios\\"]]></defaultValueExpression>
	</parameter>
	<parameter name="IMG_URL" class="java.lang.String"/>
	<parameter name="TESORERA" class="java.lang.String"/>
	<parameter name="COORDINADORA" class="java.lang.String"/>
	<queryString>
		<![CDATA[select
	to_char(ficha.fecha_ape, 'DD/MM/YYYY HH24:MI') fecha_ingreso,
	ficha.user_ingreso,
	ficha.num_ficha, ficha.descripcion_bien,
	(select STRING_AGG (upper(ente.nombre) ,  ', ' order by fp.id)
	 	from app.reg_ficha_propietarios fp
	 	inner join app.reg_ente_interviniente ente on fp.propietario = ente.id
	 	where fp.ficha = ficha.id AND fp.estado = 'A') propietarios,
	(select STRING_AGG ( num_inscripcion::text || '/' || extract(year from mov.fecha_inscripcion)::text , '; ' order by ficha_mov.id )
	 	from app.reg_movimiento_ficha ficha_mov
	 	inner join app.reg_movimiento mov on ficha_mov.movimiento = mov.id
	 	where ficha_mov.ficha = ficha.id
	)	movimientos,

	(select count(*)
	 	from app.reg_movimiento_ficha ficha_mov
	 	where ficha_mov.ficha = ficha.id
	)	cantidad_movimientos

from app.reg_ficha ficha
inner join app.acl_user us on ficha.user_ingreso = us.usuario
inner join app.acl_user_has_rol rol on rol.acl_user = us.id
where (CASE WHEN $P{USUARIO} > 0 THEN us.id=$P{USUARIO} ELSE us.id>0 END)
and rol.acl_rol = 41
and ficha.fecha_ape between to_timestamp($P{DESDE}, 'DD/MM/YYYY HH24:MI')::timestamp without time zone AND
to_timestamp($P{HASTA}, 'DD/MM/YYYY HH24:MI')::timestamp without time zone
order by fecha_ingreso asc]]>
	</queryString>
	<field name="fecha_ingreso" class="java.lang.String"/>
	<field name="user_ingreso" class="java.lang.String"/>
	<field name="num_ficha" class="java.lang.Long"/>
	<field name="descripcion_bien" class="java.lang.String"/>
	<field name="propietarios" class="java.lang.String"/>
	<field name="movimientos" class="java.lang.String"/>
	<field name="cantidad_movimientos" class="java.lang.Long"/>
	<variable name="TOTAL_FICHAS" class="java.lang.Integer" calculation="Count">
		<variableExpression><![CDATA[$F{num_ficha}]]></variableExpression>
		<initialValueExpression><![CDATA[0]]></initialValueExpression>
	</variable>
	<title>
		<band height="120" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="63" width="802" height="16" uuid="20ce27e1-57a0-421a-97c7-54a3302db764"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[REPORTE DE FICHAS REGISTRALES INGRESADAS]]></text>
			</staticText>
			<textField>
				<reportElement x="727" y="83" width="38" height="16" uuid="8103c524-5467-4837-a5b8-e89f98e75c07"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["Pág. "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="765" y="83" width="34" height="16" uuid="fdbeb83d-340b-48e5-a4e7-395ad488ce20"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="233" y="85" width="128" height="14" uuid="0eb3cd59-2287-4329-b7d2-1be1531868d8"/>
				<textFieldExpression><![CDATA[$P{HASTA_STRING}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement x="54" y="85" width="128" height="14" uuid="634c41f6-8a42-4bb1-8589-b8e1c9b82aee"/>
				<textFieldExpression><![CDATA[$P{DESDE}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="189" y="85" width="44" height="14" uuid="270e8d2c-d486-423c-8af1-ac64a9ad480b"/>
				<text><![CDATA[Hasta:]]></text>
			</staticText>
			<staticText>
				<reportElement x="10" y="85" width="44" height="14" uuid="2535145b-8625-498c-9484-e429c12b69a4"/>
				<text><![CDATA[Desde:]]></text>
			</staticText>
			<staticText>
				<reportElement x="375" y="85" width="27" height="14" uuid="bcfcde9b-058a-484f-b38d-770b52d7d32c"/>
				<text><![CDATA[De:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="402" y="85" width="179" height="14" uuid="20c7e188-dbf2-462f-9463-e6491fbcfe33"/>
				<textFieldExpression><![CDATA[$P{USUARIO} == 0 ? "TODOS" : $F{user_ingreso}]]></textFieldExpression>
			</textField>
			<image scaleImage="FillFrame" hAlign="Center" vAlign="Middle">
				<reportElement x="245" y="0" width="336" height="52" uuid="3f5a2fb4-5602-4d58-8afa-d6109889858f"/>
				<imageExpression><![CDATA[$P{IMG_URL}]]></imageExpression>
			</image>
			<textField evaluationTime="Auto">
				<reportElement x="588" y="84" width="133" height="14" uuid="16308b7b-d3be-4627-8bb1-e77532f1da76"/>
				<textElement verticalAlignment="Middle">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["Total de Fichas   " +  $V{TOTAL_FICHAS}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<columnHeader>
		<band height="14" splitType="Stretch">
			<staticText>
				<reportElement mode="Opaque" x="0" y="0" width="30" height="14" backcolor="#CCCCCC" uuid="db0048d6-d585-4c45-9057-3de99fc3da51"/>
				<box>
					<topPen lineWidth="0.4"/>
					<leftPen lineWidth="0.4"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[N°]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="30" y="0" width="75" height="14" backcolor="#CCCCCC" uuid="90398184-26f6-43b1-b389-b9eecf85f164"/>
				<box>
					<topPen lineWidth="0.4"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha Ingreso]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="105" y="0" width="70" height="14" backcolor="#CCCCCC" uuid="6140ea7c-f6c5-4508-ad99-4e0944e19ed2"/>
				<box>
					<topPen lineWidth="0.4"/>
					<leftPen lineWidth="0.4"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Usuario]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="175" y="0" width="70" height="14" backcolor="#CCCCCC" uuid="d7316016-986d-45d3-a053-37cfa4f18ae5"/>
				<box>
					<topPen lineWidth="0.4"/>
					<leftPen lineWidth="0.4"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Ficha]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="291" y="0" width="176" height="14" backcolor="#CCCCCC" uuid="cab00c3f-d179-4293-96eb-fa1503a6617a"/>
				<box>
					<topPen lineWidth="0.4"/>
					<leftPen lineWidth="0.4"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Descripción del Bien]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="467" y="0" width="138" height="14" backcolor="#CCCCCC" uuid="43fef49b-2428-43ad-8fce-c961588617d6"/>
				<box>
					<topPen lineWidth="0.4"/>
					<leftPen lineWidth="0.4"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Propietarios]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="605" y="0" width="197" height="14" backcolor="#CCCCCC" uuid="8959238d-ffbd-4684-88d6-11877038fd66"/>
				<box>
					<topPen lineWidth="0.4"/>
					<leftPen lineWidth="0.4"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Movimientos]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="245" y="0" width="46" height="14" backcolor="#CCCCCC" uuid="f8b8257c-c5d1-425d-bf9a-119970c963ff"/>
				<box>
					<pen lineWidth="0.4"/>
					<topPen lineWidth="0.4"/>
					<leftPen lineWidth="0.4"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Cant. Mov.]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="10" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="0" y="0" width="30" height="10" isPrintWhenDetailOverflows="true" uuid="a7335cd9-5554-4cc2-9d96-acf37ba3d067"/>
				<box leftPadding="2">
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.4"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{REPORT_COUNT}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="30" y="0" width="75" height="10" isPrintWhenDetailOverflows="true" uuid="fa80cda7-5dbd-4c57-a893-f874738fb04b"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha_ingreso}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy HH.mm.ss" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="105" y="0" width="70" height="10" isPrintWhenDetailOverflows="true" uuid="c55a1ce0-d0b2-4b68-9941-5e9978f2d8a1"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{user_ingreso}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="175" y="0" width="70" height="10" isPrintWhenDetailOverflows="true" uuid="f1912905-d01e-44a1-947f-34e07aa0df28"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{num_ficha}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="291" y="0" width="176" height="10" isPrintWhenDetailOverflows="true" uuid="df8a34f4-777c-458e-93e3-75569d9609e2"/>
				<box leftPadding="2">
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{descripcion_bien}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#,##0.00" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="467" y="0" width="138" height="10" isPrintWhenDetailOverflows="true" uuid="3d25af62-edf1-49e6-9e89-43f80723c563"/>
				<box topPadding="1" leftPadding="2" bottomPadding="1" rightPadding="2">
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{propietarios}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#,##0.00" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="605" y="0" width="197" height="10" isPrintWhenDetailOverflows="true" uuid="46522a3c-6211-49d3-8472-52f298603779"/>
				<box topPadding="1" leftPadding="2" bottomPadding="1" rightPadding="1">
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{movimientos}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="245" y="0" width="46" height="10" isPrintWhenDetailOverflows="true" uuid="949d574d-a9c4-48c4-b1ea-64db2ebfdeb6"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cantidad_movimientos}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="23">
			<staticText>
				<reportElement x="290" y="9" width="112" height="14" uuid="941b0e7b-9a5f-4e52-8fac-94744c6515e5"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha de Impresión:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement x="402" y="9" width="150" height="14" uuid="00baf40a-8f5b-4d9b-8c01-1fedd64f2acb"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
